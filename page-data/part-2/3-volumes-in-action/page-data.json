{"componentChunkName":"component---src-templates-course-content-template-js","path":"/part-2/3-volumes-in-action","result":{"data":{"page":{"htmlAst":{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Next we're going to set up "},{"type":"element","tagName":"a","properties":{"href":"https://www.redmine.org/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Redmine"}]},{"type":"text","value":", a PostgreSQL database and "},{"type":"element","tagName":"a","properties":{"href":"https://www.adminer.org/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Adminer"}]},{"type":"text","value":". All of them have official docker images available as we can see from "},{"type":"element","tagName":"a","properties":{"href":"https://hub.docker.com/_/redmine","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Redmine"}]},{"type":"text","value":", "},{"type":"element","tagName":"a","properties":{"href":"https://hub.docker.com/_/postgres","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Postgres"}]},{"type":"text","value":" and "},{"type":"element","tagName":"a","properties":{"href":"https://hub.docker.com/_/adminer","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Adminer"}]},{"type":"text","value":" respectively. The officiality of the containers is not that important, just that we can expect that it will have some support. We could also, for example, setup Wordpress or a MediaWiki inside containers in the same manner if you're interested in running existing applications inside docker. You could even set up your own personal "},{"type":"element","tagName":"a","properties":{"href":"https://hub.docker.com/_/sentry/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Sentry"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In "},{"type":"element","tagName":"a","properties":{"href":"https://hub.docker.com/_/redmine","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://hub.docker.com/_/redmine"}]},{"type":"text","value":" there is a list of different variants in "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Supported tags and respective Dockerfile links"}]},{"type":"text","value":" - most likely for this testing we can use any of the images. From \"Environment Variables\" we can see that all variants can use "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"REDMINE_DB_POSTGRES"}]},{"type":"text","value":" or "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"REDMINE_DB_MYSQL"}]},{"type":"text","value":" environment variables to set up the database, or it will fallback to SQLite. So before moving forward, let's setup postgres."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In "},{"type":"element","tagName":"a","properties":{"href":"https://hub.docker.com/_/postgres","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://hub.docker.com/_/postgres"}]},{"type":"text","value":" there's a sample compose file under \"via docker stack deploy or docker-compose\" - Let's strip that down to"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"version"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"3.8\""}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"services"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"db"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"image"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" postgres"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"13.2"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"alpine\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"restart"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" unless"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"stopped\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"environment"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"POSTGRES_PASSWORD"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" example\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"container_name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" db_redmine"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Note:"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"restart: always"}]},{"type":"text","value":" was changed to "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"unless-stopped"}]},{"type":"text","value":" that will keep the container running unless it's stopped. With "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"always"}]},{"type":"text","value":" the stopped container is started after reboot for example."}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Under \"Caveats - Where to Store Data\" we can see that the "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"/var/lib/postgresql/data"}]},{"type":"text","value":" can be mounted separately to preserve data in an easy-to-locate directory or let Docker manage the storage. We could use a bind mount like previously, but let's first see what the \"let Docker manage the storage\" means. Let's run the docker-compose file without setting anything new:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"$ docker-compose up\n\n  Creating network \"redmine_default\" with the default driver\n  Creating db_redmine ... done\n  Attaching to db_redmine\n  db_redmine | The files belonging to this database system will be owned by user \"postgres\".\n  ...\n  db_redmine | 2019-03-03 10:27:22.975 UTC [1] LOG:  listening on IPv4 address \"0.0.0.0\", port 5432\n  db_redmine | 2019-03-03 10:27:22.975 UTC [1] LOG:  listening on IPv6 address \"::\", port 5432\n  db_redmine | 2019-03-03 10:27:22.979 UTC [1] LOG:  listening on Unix socket \"/var/run/postgresql/.s.PGSQL.5432\"\n  db_redmine | 2019-03-03 10:27:22.995 UTC [50] LOG:  database system was shut down at 2019-03-03 10:27:22 UTC\n  db_redmine | 2019-03-03 10:27:23.002 UTC [1] LOG:  database system is ready to accept connections"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The image initializes the data files in the first start. Let's terminate the container with ^C. Compose uses the current directory as a prefix for container and volume names so that different projects don't clash. The prefix can be overridden with "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"COMPOSE_PROJECT_NAME"}]},{"type":"text","value":" environment variable if needed."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let's "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"inspect"}]},{"type":"text","value":" if there was a volume created with "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker container inspect db_redmine | grep -A 5 Mounts"}]}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"json"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-json"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-json"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"Mounts\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"Type\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"volume\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"Name\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"794c9d8db6b5e643865c8364bf3b807b4165291f02508404ff3309b8ffde01df\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"Source\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"/var/lib/docker/volumes/794c9d8db6b5e643865c8364bf3b807b4165291f02508404ff3309b8ffde01df/_data\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"Destination\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"/var/lib/postgresql/data\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now if we check out "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker volume ls"}]},{"type":"text","value":" we can see that a volume with name \"794c9d8db6b5e643865c8364bf3b807b4165291f02508404ff3309b8ffde01df\" exists."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"$ docker volume ls\n  DRIVER              VOLUME NAME\n  local               794c9d8db6b5e643865c8364bf3b807b4165291f02508404ff3309b8ffde01df"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"There may be more volumes on your machine. If you want to get rid of them you can use "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker volume prune"}]},{"type":"text","value":". Let's put the whole \"application\" down now with "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker-compose down"}]},{"type":"text","value":". Then, this time let's create a separate volume for the data."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"version"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"3.8\""}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"services"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"db"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"image"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" postgres"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"13.2"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"alpine\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"restart"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" unless"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"stopped\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"environment"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"POSTGRES_PASSWORD"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" example\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"container_name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" db_redmine\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"volumes"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" database"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"/var/lib/postgresql/data\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"volumes"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  database"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]}]}]}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"$ docker volume ls\n  DRIVER              VOLUME NAME\n  local               redmine_database\n\n$ docker container inspect db_redmine | grep -A 5 Mounts\n\"Mounts\": [\n    {\n        \"Type\": \"volume\",\n        \"Name\": \"redmine_database\",\n        \"Source\": \"/var/lib/docker/volumes/ongoing_redminedata/_data\",\n        \"Destination\": \"/var/lib/postgresql/data\","}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ok, looks a bit more human readable even if it isn't more accessible than bind mounts. Now when the Postgres is running, let's add the "},{"type":"element","tagName":"a","properties":{"href":"https://hub.docker.com/_/redmine","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"redmine"}]},{"type":"text","value":". The container seems to require just two environment variables."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"redmine"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"image"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" redmine"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"4.1"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"alpine\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"environment"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" REDMINE_DB_POSTGRES=db\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" REDMINE_DB_PASSWORD=example\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"ports"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" 9999"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"3000"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"depends_on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" db"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Notice the "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"depends_on"}]},{"type":"text","value":" declaration. This makes sure that the that "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"db"}]},{"type":"text","value":" service should be started first. "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"depends_on"}]},{"type":"text","value":" does not guarantee that the database is up, just that the service is started first. The Postgres server is accessible with dns name \"db\" from the redmine service as discussed in the \"docker networking\" section"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now when you run "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker-compose up"}]},{"type":"text","value":" you will see a bunch of database migrations running first."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"  redmine_1  | I, [2019-03-03T10:59:20.956936 #25]  INFO -- : Migrating to Setup (1)\n  redmine_1  | == 1 Setup: migrating =========================================================\n  ...\n  redmine_1  | [2019-03-03 11:01:10] INFO  ruby 2.6.1 (2019-01-30) [x86_64-linux]\n  redmine_1  | [2019-03-03 11:01:10] INFO  WEBrick::HTTPServer#start: pid=1 port=3000"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We can see that image also creates files to "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"/usr/src/redmine/files"}]},{"type":"text","value":" that also need to be persisted. The Dockerfile has this "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/docker-library/redmine/blob/cea16044e97567c28802fc8cc06f6cd036c49a5c/4.0/Dockerfile#L155","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"line"}]},{"type":"text","value":" where it declares that a volume should be created. Again docker will create the volume, but it will be handled as an anonymous volume that is not managed by compose, so it's better to be explicit about the volume. With that in mind our final file should look like this:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"version"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"3.8\""}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"services"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"db"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"image"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" postgres"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"13.2"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"alpine\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"restart"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" unless"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"stopped\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"environment"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"POSTGRES_PASSWORD"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" example\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"container_name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" db_redmine\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"volumes"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" database"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"/var/lib/postgresql/data\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"redmine"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"image"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" redmine"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"4.1"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"alpine\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"environment"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" REDMINE_DB_POSTGRES=db\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" REDMINE_DB_PASSWORD=example\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"ports"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" 9999"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"3000"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"volumes"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" files"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"/usr/src/redmine/files\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"depends_on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" db\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"volumes"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"database"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  files"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now we can use the application with our browser through "},{"type":"element","tagName":"a","properties":{"href":"http://localhost:9999","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"http://localhost:9999"}]},{"type":"text","value":". After some changes inside the application we can inspect the changes that happened in the image and check that no extra meaningful files got written to the container:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"$ docker container diff $(docker-compose ps -q redmine)\n  C /usr/src/redmine/config/environment.rb\n  ...\n  C /usr/src/redmine/tmp/pdf"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Probably not."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Next, we will add adminer to the application. We could also just use psql to interact with a postgres database with "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker container exec -it db_redmine psql -U postgres"}]},{"type":"text","value":". (The command "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"exec"}]},{"type":"text","value":"utes psql -U postgres inside the container) The same method can be used to create backups with pg_dump: "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker container exec db_redmine pg_dump -U postgres > redmine.dump"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This step is straightforward, we actually had the instructions open back before we set up postgres. But let's check the "},{"type":"element","tagName":"a","properties":{"href":"https://hub.docker.com/_/adminer","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"documentation"}]},{"type":"text","value":" and we see that the following will suffice:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"adminer"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"image"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" adminer"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"4"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"restart"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" always\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"environment"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" ADMINER_DESIGN=galkaev\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"ports"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" 8083"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"8080"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now when we run the application we can access adminer from "},{"type":"element","tagName":"a","properties":{"href":"http://localhost:8083","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"http://localhost:8083"}]},{"type":"text","value":". Setting up adminer is straightforward since it will be able to access the database through docker network."}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 2.6"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Add database to example backend."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Lets use a postgres database to save messages. We won't need to configure a volume since the official postgres image\nsets a default volume for us. Lets use the postgres image documentation to our advantage when configuring:\n"},{"type":"element","tagName":"a","properties":{"href":"https://hub.docker.com/_/postgres/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://hub.docker.com/_/postgres/"}]},{"type":"text","value":". Especially part Environment Variables is of\ninterest."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The backend "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/docker-hy/material-applications/tree/main/example-backend","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"README"}]},{"type":"text","value":" should have all the information needed to\nconnect."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The button won't turn green but you can send messages to yourself."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Submit the docker-compose.yml"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"TIP: When configuring the database, you might need to destroy the automatically created volumes. Use command "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker volume prune"}]},{"type":"text","value":", "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker volume ls"}]},{"type":"text","value":" and "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker volume rm"}]},{"type":"text","value":" to remove unused volumes when testing. Make sure to remove containers that depend on them beforehand."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"restart: unless-stopped"}]},{"type":"text","value":" can help if the postgres takes a while to get ready"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 713px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/f8422e87ea942e4462539c60b6779838/01267/back-front-redis-and-database.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 40.869565217391305%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAACIklEQVQoz4VRv4vTcBR/9dSjNzjrICieSxUHDxT18AaH+wMEwUlBHATxx3BrcRB6FcUOTi1yaxVpK+3QIZQ2lJZeqaFp06bpt01ImjZJk29yTclmv/ItDm6+5T0+fN77fHgfiMfj2wCwwbLsXqPReJTJZC4TQkBV1fJkMiGKohBVVYlhGB2KVyoV4Hn+vCzLd2az2e1er7dDcc/zDmzb/gnJZJIe3Eyn0xcFQXjdbDb3KEGSpANZlr/3+/0jhNA3RVHeEULCuq7DaDR64TgOwRgT27Z/p1KpC6PR6FiWZULVbkSj0XOtVuuhKIpPB4PB83w+f3M8Hh+6rvsLY1z2ff9Y07SvDMM84Xn+Lcdxr+bz+QfHcd4ghJ5RA51O54EgCC+h3W6DKIohy7K2MMabGOMtSrAs6whjfGLbtuJ53onjOOlcLheWJCk5GAzeAwAghPYXi8UPjPEhISSEEALgOO5UoVAATdNgOp3CfD6HUqkEu7u7p2Ox2Fld188AQDibzV5vt9tXqRhdpN113S9BEJAgCFxZlrcxxgC+768Jy+USgiCA1WoFLMtCNBqFYrEIiURivVyr1a5JkvS4Xq/fQwjtqKoaprhpmvuapt2iM3UJ/xbDMFCtVtdJUpetVgt6vd5Gt9ulId31PI/QMGgvl8v36RHDMHjDMFg6/7cikQgMh8OQKIr011dM0/xsmuZH0zQ/MQxzCQBCkiSpCKHmX4fwBz1pnAeDGkEhAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n          "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/f8422e87ea942e4462539c60b6779838/a0b58/back-front-redis-and-database.webp 230w","/static/f8422e87ea942e4462539c60b6779838/bc10c/back-front-redis-and-database.webp 460w","/static/f8422e87ea942e4462539c60b6779838/69b3e/back-front-redis-and-database.webp 713w"],"sizes":"(max-width: 713px) 100vw, 713px","type":"image/webp"},"children":[]},{"type":"text","value":"\n          "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/f8422e87ea942e4462539c60b6779838/81c8e/back-front-redis-and-database.png 230w","/static/f8422e87ea942e4462539c60b6779838/08a84/back-front-redis-and-database.png 460w","/static/f8422e87ea942e4462539c60b6779838/01267/back-front-redis-and-database.png 713w"],"sizes":"(max-width: 713px) 100vw, 713px","type":"image/png"},"children":[]},{"type":"text","value":"\n          "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/f8422e87ea942e4462539c60b6779838/01267/back-front-redis-and-database.png","alt":"back front redis and database","title":"back front redis and database","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n        "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 2.7"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Configure a "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Machine_learning","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"machine learning"}]},{"type":"text","value":" project."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Look into machine learning project created with Python and React and split into three parts:\n"},{"type":"element","tagName":"a","properties":{"href":"https://github.com/docker-hy/ml-kurkkumopo-frontend","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"frontend"}]},{"type":"text","value":",\n"},{"type":"element","tagName":"a","properties":{"href":"https://github.com/docker-hy/ml-kurkkumopo-backend","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"backend"}]},{"type":"text","value":" and\n"},{"type":"element","tagName":"a","properties":{"href":"https://github.com/docker-hy/ml-kurkkumopo-training","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"training"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Note that the training requires 2 volumes and backend should share volume "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"/src/model"}]},{"type":"text","value":" with training."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The frontend will display on "},{"type":"element","tagName":"a","properties":{"href":"http://localhost:3000","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"http://localhost:3000"}]},{"type":"text","value":" and the application will tell if the subject of an image looks more\nlike a cucumber or a moped."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Submit the docker-compose.yml"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This exercise is known to have broken for some attendees based on CPU. The error looks something like \"Illegal instruction (core dumped)\". Try downgrading / upgrading the tensorflow found in requirements.txt or join the Discord channel and message with Jakousa#1337."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Note that the generated model is a toy and will not produce good results."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"It will take SEVERAL minutes to build the docker images, download training pictures and train the classifying model."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This exercise was created by "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/sasumaki","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Sasu Mkinen"}]}]}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 2.8"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Add "},{"type":"element","tagName":"a","properties":{"href":"https://hub.docker.com/_/nginx","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"nginx"}]},{"type":"text","value":" to example frontend + backend."}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 646px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/d9c4468d5acf0246dbba4e71c2ee46ef/27524/back-front-redis-database-and-nginx.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 51.30434782608696%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABJUlEQVQoz2WS547DQAiE/f5P6KLIP1zj3hNXom9P5NZ3SAjwLsMwa6eqKhnHUYh930uWZbdaz8mLopAoiiQIAvF9X8IwlKZpRO26LnFoOI5D1nWV8zxN8zAMMs+zASHu+27OyQEoy9KAt20rXdfJtm0GDHO4pAX2fr9NEwB/bVkW4wBopH+aJnm9Xj+ANl0FhLVeUIMlrOq6/kY8SRJ5PB6/gADZDFmXNQDmEmujG9oqcxxplCnfkevLUAGJgKFNnucmsg4RhqwH+PP5NLXdRw3oDRCjiamwQHxcpxNVLx0AAWpy/KahPRFAtKRBH4gVAbKNMwgokX8r6wMgOHqyLhqRx3EsaZqa38y+T60SOPY0+wIArAdDch7JdV3xPO+2kS0Xj/IBAEUIhg7Pvo8AAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n          "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/d9c4468d5acf0246dbba4e71c2ee46ef/a0b58/back-front-redis-database-and-nginx.webp 230w","/static/d9c4468d5acf0246dbba4e71c2ee46ef/bc10c/back-front-redis-database-and-nginx.webp 460w","/static/d9c4468d5acf0246dbba4e71c2ee46ef/8c2f2/back-front-redis-database-and-nginx.webp 646w"],"sizes":"(max-width: 646px) 100vw, 646px","type":"image/webp"},"children":[]},{"type":"text","value":"\n          "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/d9c4468d5acf0246dbba4e71c2ee46ef/81c8e/back-front-redis-database-and-nginx.png 230w","/static/d9c4468d5acf0246dbba4e71c2ee46ef/08a84/back-front-redis-database-and-nginx.png 460w","/static/d9c4468d5acf0246dbba4e71c2ee46ef/27524/back-front-redis-database-and-nginx.png 646w"],"sizes":"(max-width: 646px) 100vw, 646px","type":"image/png"},"children":[]},{"type":"text","value":"\n          "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/d9c4468d5acf0246dbba4e71c2ee46ef/27524/back-front-redis-database-and-nginx.png","alt":"back front redis database and nginx","title":"back front redis database and nginx","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n        "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Accessing your service from arbitrary port is counter intuitive since browsers use 80 (http) and 443 (https) by\ndefault. And having the service refer to two origins in a case where there's only one backend isn't desirable either. We will skip the SSL setup for https/443."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nginx will function as a "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Reverse_proxy","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"reverse proxy"}]},{"type":"text","value":" for us (see the image above).\nThe requests arriving at anything other than /api will be redirected to frontend container and /api will get\nredirected to backend container."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"At the end you should see that the frontend is accessible simply by going to "},{"type":"element","tagName":"a","properties":{"href":"http://localhost","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"http://localhost"}]},{"type":"text","value":" and the button works.\nOther buttons may have stopped working, do not worry about them."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"As we will not start configuring reverse proxies on this course you can have a simple config file:"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The following file should be set to /etc/nginx/nginx.conf inside the nginx container. You can use a file volume where\nthe contents of the file are the following:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"events { worker_connections 1024; }\n\nhttp {\n  server {\n    listen 80;\n\n    location / {\n      proxy_pass _frontend-connection-url_;\n    }\n\n    location /api/ {\n      proxy_set_header Host $host;\n      proxy_pass _backend-connection-url_;\n    }\n  }\n}"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nginx, backend and frontend should be connected in the same network. See the image above for how the services are connected."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Submit the docker-compose.yml"}]},{"type":"element","tagName":"text-box","properties":{"name":"Tips for making sure the backend connection works","variant":"hint"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Try using your browser to access "},{"type":"element","tagName":"a","properties":{"href":"http://localhost/api/ping","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"http://localhost/api/ping"}]},{"type":"text","value":" and see if it answers pong"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"It might be nginx configuration problem: Add trailing "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"/"}]},{"type":"text","value":" to the backend url in the nginx.conf."}]}]}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 2.9"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Postgres image uses a volume by default. Manually define volumes for the database in convenient location such as in\n"},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"./database"}]},{"type":"text","value":" . Use the image documentations (postgres) to help you with the task. You may do the same for redis as\nwell."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"After you have configured the volume:"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Save a few messages through the frontend"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Run "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker-compose down"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Run "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker-compose up"}]},{"type":"text","value":" and see that the messages are available after refreshing browser"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Run "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker-compose down"}]},{"type":"text","value":" and delete the volume folder manually"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Run "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker-compose up"}]},{"type":"text","value":" and the data should be gone"}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Maybe it would be simpler to back them up now that you know where they are."}]},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"TIP: To save you the trouble of testing all of those steps, just look into the folder before trying the steps. If\nit's empty after docker-compose up then something is wrong."}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"TIP: Since you may have broken the buttons in nginx exercise you should test with a version of docker-compose.yml that doesn't break the buttons"}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Submit the docker-compose.yml"}]}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 2.10"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Some buttons may have stopped working in the frontend + backend project. Make sure that every button for exercises\nworks."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This may need a peek into the browsers developer consoles again like back part 1. The buttons of nginx exercise and\nthe first button behave differently but you want them to match."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If you had to do any changes explain what you had to change."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Submit the docker-compose yml and both dockerfiles."}]}]}]},"html":"<div><p>Next we're going to set up <a href=\"https://www.redmine.org/\" target=\"_blank\" rel=\"noopener noreferrer\">Redmine</a>, a PostgreSQL database and <a href=\"https://www.adminer.org/\" target=\"_blank\" rel=\"noopener noreferrer\">Adminer</a>. All of them have official docker images available as we can see from <a href=\"https://hub.docker.com/_/redmine\" target=\"_blank\" rel=\"noopener noreferrer\">Redmine</a>, <a href=\"https://hub.docker.com/_/postgres\" target=\"_blank\" rel=\"noopener noreferrer\">Postgres</a> and <a href=\"https://hub.docker.com/_/adminer\" target=\"_blank\" rel=\"noopener noreferrer\">Adminer</a> respectively. The officiality of the containers is not that important, just that we can expect that it will have some support. We could also, for example, setup Wordpress or a MediaWiki inside containers in the same manner if you're interested in running existing applications inside docker. You could even set up your own personal <a href=\"https://hub.docker.com/_/sentry/\" target=\"_blank\" rel=\"noopener noreferrer\">Sentry</a>.</p><p>In <a href=\"https://hub.docker.com/_/redmine\" target=\"_blank\" rel=\"noopener noreferrer\">https://hub.docker.com/_/redmine</a> there is a list of different variants in <code class=\"language-text\">Supported tags and respective Dockerfile links</code> - most likely for this testing we can use any of the images. From \"Environment Variables\" we can see that all variants can use <code class=\"language-text\">REDMINE_DB_POSTGRES</code> or <code class=\"language-text\">REDMINE_DB_MYSQL</code> environment variables to set up the database, or it will fallback to SQLite. So before moving forward, let's setup postgres.</p><p>In <a href=\"https://hub.docker.com/_/postgres\" target=\"_blank\" rel=\"noopener noreferrer\">https://hub.docker.com/_/postgres</a> there's a sample compose file under \"via docker stack deploy or docker-compose\" - Let's strip that down to</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3.8\"</span>\n\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">db</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> postgres<span class=\"token punctuation\">:</span>13.2<span class=\"token punctuation\">-</span>alpine\n    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> unless<span class=\"token punctuation\">-</span>stopped\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">POSTGRES_PASSWORD</span><span class=\"token punctuation\">:</span> example\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> db_redmine</code></pre></div><p>Note:</p><ul>\n<li><code class=\"language-text\">restart: always</code> was changed to <code class=\"language-text\">unless-stopped</code> that will keep the container running unless it's stopped. With <code class=\"language-text\">always</code> the stopped container is started after reboot for example.</li>\n</ul><p>Under \"Caveats - Where to Store Data\" we can see that the <code class=\"language-text\">/var/lib/postgresql/data</code> can be mounted separately to preserve data in an easy-to-locate directory or let Docker manage the storage. We could use a bind mount like previously, but let's first see what the \"let Docker manage the storage\" means. Let's run the docker-compose file without setting anything new:</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ docker-compose up\n\n  Creating network &quot;redmine_default&quot; with the default driver\n  Creating db_redmine ... done\n  Attaching to db_redmine\n  db_redmine | The files belonging to this database system will be owned by user &quot;postgres&quot;.\n  ...\n  db_redmine | 2019-03-03 10:27:22.975 UTC [1] LOG:  listening on IPv4 address &quot;0.0.0.0&quot;, port 5432\n  db_redmine | 2019-03-03 10:27:22.975 UTC [1] LOG:  listening on IPv6 address &quot;::&quot;, port 5432\n  db_redmine | 2019-03-03 10:27:22.979 UTC [1] LOG:  listening on Unix socket &quot;/var/run/postgresql/.s.PGSQL.5432&quot;\n  db_redmine | 2019-03-03 10:27:22.995 UTC [50] LOG:  database system was shut down at 2019-03-03 10:27:22 UTC\n  db_redmine | 2019-03-03 10:27:23.002 UTC [1] LOG:  database system is ready to accept connections</code></pre></div><p>The image initializes the data files in the first start. Let's terminate the container with ^C. Compose uses the current directory as a prefix for container and volume names so that different projects don't clash. The prefix can be overridden with <code class=\"language-text\">COMPOSE_PROJECT_NAME</code> environment variable if needed.</p><p>Let's <strong>inspect</strong> if there was a volume created with <code class=\"language-text\">docker container inspect db_redmine | grep -A 5 Mounts</code></p><div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"Mounts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"Type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"volume\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"Name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"794c9d8db6b5e643865c8364bf3b807b4165291f02508404ff3309b8ffde01df\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"Source\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/var/lib/docker/volumes/794c9d8db6b5e643865c8364bf3b807b4165291f02508404ff3309b8ffde01df/_data\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"Destination\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/var/lib/postgresql/data\"</span><span class=\"token punctuation\">,</span></code></pre></div><p>Now if we check out <code class=\"language-text\">docker volume ls</code> we can see that a volume with name \"794c9d8db6b5e643865c8364bf3b807b4165291f02508404ff3309b8ffde01df\" exists.</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ docker volume ls\n  DRIVER              VOLUME NAME\n  local               794c9d8db6b5e643865c8364bf3b807b4165291f02508404ff3309b8ffde01df</code></pre></div><p>There may be more volumes on your machine. If you want to get rid of them you can use <code class=\"language-text\">docker volume prune</code>. Let's put the whole \"application\" down now with <code class=\"language-text\">docker-compose down</code>. Then, this time let's create a separate volume for the data.</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3.8\"</span>\n\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">db</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> postgres<span class=\"token punctuation\">:</span>13.2<span class=\"token punctuation\">-</span>alpine\n    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> unless<span class=\"token punctuation\">-</span>stopped\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">POSTGRES_PASSWORD</span><span class=\"token punctuation\">:</span> example\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> db_redmine\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> database<span class=\"token punctuation\">:</span>/var/lib/postgresql/data\n\n<span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n  database<span class=\"token punctuation\">:</span></code></pre></div><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ docker volume ls\n  DRIVER              VOLUME NAME\n  local               redmine_database\n\n$ docker container inspect db_redmine | grep -A 5 Mounts\n&quot;Mounts&quot;: [\n    {\n        &quot;Type&quot;: &quot;volume&quot;,\n        &quot;Name&quot;: &quot;redmine_database&quot;,\n        &quot;Source&quot;: &quot;/var/lib/docker/volumes/ongoing_redminedata/_data&quot;,\n        &quot;Destination&quot;: &quot;/var/lib/postgresql/data&quot;,</code></pre></div><p>Ok, looks a bit more human readable even if it isn't more accessible than bind mounts. Now when the Postgres is running, let's add the <a href=\"https://hub.docker.com/_/redmine\" target=\"_blank\" rel=\"noopener noreferrer\">redmine</a>. The container seems to require just two environment variables.</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">redmine</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> redmine<span class=\"token punctuation\">:</span>4.1<span class=\"token punctuation\">-</span>alpine\n  <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> REDMINE_DB_POSTGRES=db\n    <span class=\"token punctuation\">-</span> REDMINE_DB_PASSWORD=example\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> 9999<span class=\"token punctuation\">:</span><span class=\"token number\">3000</span>\n  <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> db</code></pre></div><p>Notice the <code class=\"language-text\">depends_on</code> declaration. This makes sure that the that <code class=\"language-text\">db</code> service should be started first. <code class=\"language-text\">depends_on</code> does not guarantee that the database is up, just that the service is started first. The Postgres server is accessible with dns name \"db\" from the redmine service as discussed in the \"docker networking\" section</p><p>Now when you run <code class=\"language-text\">docker-compose up</code> you will see a bunch of database migrations running first.</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">  redmine_1  | I, [2019-03-03T10:59:20.956936 #25]  INFO -- : Migrating to Setup (1)\n  redmine_1  | == 1 Setup: migrating =========================================================\n  ...\n  redmine_1  | [2019-03-03 11:01:10] INFO  ruby 2.6.1 (2019-01-30) [x86_64-linux]\n  redmine_1  | [2019-03-03 11:01:10] INFO  WEBrick::HTTPServer#start: pid=1 port=3000</code></pre></div><p>We can see that image also creates files to <code class=\"language-text\">/usr/src/redmine/files</code> that also need to be persisted. The Dockerfile has this <a href=\"https://github.com/docker-library/redmine/blob/cea16044e97567c28802fc8cc06f6cd036c49a5c/4.0/Dockerfile#L155\" target=\"_blank\" rel=\"noopener noreferrer\">line</a> where it declares that a volume should be created. Again docker will create the volume, but it will be handled as an anonymous volume that is not managed by compose, so it's better to be explicit about the volume. With that in mind our final file should look like this:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3.8\"</span>\n\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">db</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> postgres<span class=\"token punctuation\">:</span>13.2<span class=\"token punctuation\">-</span>alpine\n    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> unless<span class=\"token punctuation\">-</span>stopped\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">POSTGRES_PASSWORD</span><span class=\"token punctuation\">:</span> example\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> db_redmine\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> database<span class=\"token punctuation\">:</span>/var/lib/postgresql/data\n  <span class=\"token key atrule\">redmine</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> redmine<span class=\"token punctuation\">:</span>4.1<span class=\"token punctuation\">-</span>alpine\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> REDMINE_DB_POSTGRES=db\n      <span class=\"token punctuation\">-</span> REDMINE_DB_PASSWORD=example\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> 9999<span class=\"token punctuation\">:</span><span class=\"token number\">3000</span>\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> files<span class=\"token punctuation\">:</span>/usr/src/redmine/files\n    <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> db\n\n<span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">database</span><span class=\"token punctuation\">:</span>\n  files<span class=\"token punctuation\">:</span></code></pre></div><p>Now we can use the application with our browser through <a href=\"http://localhost:9999\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost:9999</a>. After some changes inside the application we can inspect the changes that happened in the image and check that no extra meaningful files got written to the container:</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ docker container diff $(docker-compose ps -q redmine)\n  C /usr/src/redmine/config/environment.rb\n  ...\n  C /usr/src/redmine/tmp/pdf</code></pre></div><p>Probably not.</p><p>Next, we will add adminer to the application. We could also just use psql to interact with a postgres database with <code class=\"language-text\">docker container exec -it db_redmine psql -U postgres</code>. (The command <strong>exec</strong>utes psql -U postgres inside the container) The same method can be used to create backups with pg_dump: <code class=\"language-text\">docker container exec db_redmine pg_dump -U postgres &gt; redmine.dump</code>.</p><p>This step is straightforward, we actually had the instructions open back before we set up postgres. But let's check the <a href=\"https://hub.docker.com/_/adminer\" target=\"_blank\" rel=\"noopener noreferrer\">documentation</a> and we see that the following will suffice:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">adminer</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> adminer<span class=\"token punctuation\">:</span><span class=\"token number\">4</span>\n  <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always\n  <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> ADMINER_DESIGN=galkaev\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> 8083<span class=\"token punctuation\">:</span><span class=\"token number\">8080</span></code></pre></div><p>Now when we run the application we can access adminer from <a href=\"http://localhost:8083\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost:8083</a>. Setting up adminer is straightforward since it will be able to access the database through docker network.</p><exercise name=\"Exercise 2.6\"><p>Add database to example backend.</p><p>Lets use a postgres database to save messages. We won't need to configure a volume since the official postgres image\nsets a default volume for us. Lets use the postgres image documentation to our advantage when configuring:\n<a href=\"https://hub.docker.com/_/postgres/\" target=\"_blank\" rel=\"noopener noreferrer\">https://hub.docker.com/_/postgres/</a>. Especially part Environment Variables is of\ninterest.</p><p>The backend <a href=\"https://github.com/docker-hy/material-applications/tree/main/example-backend\" target=\"_blank\" rel=\"noopener noreferrer\">README</a> should have all the information needed to\nconnect.</p><p>The button won't turn green but you can send messages to yourself.</p><p>Submit the docker-compose.yml</p><ul>\n<li>\n<p>TIP: When configuring the database, you might need to destroy the automatically created volumes. Use command <code class=\"language-text\">docker volume prune</code>, <code class=\"language-text\">docker volume ls</code> and <code class=\"language-text\">docker volume rm</code> to remove unused volumes when testing. Make sure to remove containers that depend on them beforehand.</p>\n</li>\n<li>\n<p><code class=\"language-text\">restart: unless-stopped</code> can help if the postgres takes a while to get ready</p>\n</li>\n</ul><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 713px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/f8422e87ea942e4462539c60b6779838/01267/back-front-redis-and-database.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 40.869565217391305%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAACIklEQVQoz4VRv4vTcBR/9dSjNzjrICieSxUHDxT18AaH+wMEwUlBHATxx3BrcRB6FcUOTi1yaxVpK+3QIZQ2lJZeqaFp06bpt01ImjZJk29yTclmv/ItDm6+5T0+fN77fHgfiMfj2wCwwbLsXqPReJTJZC4TQkBV1fJkMiGKohBVVYlhGB2KVyoV4Hn+vCzLd2az2e1er7dDcc/zDmzb/gnJZJIe3Eyn0xcFQXjdbDb3KEGSpANZlr/3+/0jhNA3RVHeEULCuq7DaDR64TgOwRgT27Z/p1KpC6PR6FiWZULVbkSj0XOtVuuhKIpPB4PB83w+f3M8Hh+6rvsLY1z2ff9Y07SvDMM84Xn+Lcdxr+bz+QfHcd4ghJ5RA51O54EgCC+h3W6DKIohy7K2MMabGOMtSrAs6whjfGLbtuJ53onjOOlcLheWJCk5GAzeAwAghPYXi8UPjPEhISSEEALgOO5UoVAATdNgOp3CfD6HUqkEu7u7p2Ox2Fld188AQDibzV5vt9tXqRhdpN113S9BEJAgCFxZlrcxxgC+768Jy+USgiCA1WoFLMtCNBqFYrEIiURivVyr1a5JkvS4Xq/fQwjtqKoaprhpmvuapt2iM3UJ/xbDMFCtVtdJUpetVgt6vd5Gt9ulId31PI/QMGgvl8v36RHDMHjDMFg6/7cikQgMh8OQKIr011dM0/xsmuZH0zQ/MQxzCQBCkiSpCKHmX4fwBz1pnAeDGkEhAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <picture>\n          <source srcset=\"/static/f8422e87ea942e4462539c60b6779838/a0b58/back-front-redis-and-database.webp 230w,\n/static/f8422e87ea942e4462539c60b6779838/bc10c/back-front-redis-and-database.webp 460w,\n/static/f8422e87ea942e4462539c60b6779838/69b3e/back-front-redis-and-database.webp 713w\" sizes=\"(max-width: 713px) 100vw, 713px\" type=\"image/webp\">\n          <source srcset=\"/static/f8422e87ea942e4462539c60b6779838/81c8e/back-front-redis-and-database.png 230w,\n/static/f8422e87ea942e4462539c60b6779838/08a84/back-front-redis-and-database.png 460w,\n/static/f8422e87ea942e4462539c60b6779838/01267/back-front-redis-and-database.png 713w\" sizes=\"(max-width: 713px) 100vw, 713px\" type=\"image/png\">\n          <img class=\"gatsby-resp-image-image\" src=\"/static/f8422e87ea942e4462539c60b6779838/01267/back-front-redis-and-database.png\" alt=\"back front redis and database\" title=\"back front redis and database\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n        </picture>\n  </a>\n    </span></exercise><exercise name=\"Exercise 2.7\"><p>Configure a <a href=\"https://en.wikipedia.org/wiki/Machine_learning\" target=\"_blank\" rel=\"noopener noreferrer\">machine learning</a> project.</p><p>Look into machine learning project created with Python and React and split into three parts:\n<a href=\"https://github.com/docker-hy/ml-kurkkumopo-frontend\" target=\"_blank\" rel=\"noopener noreferrer\">frontend</a>,\n<a href=\"https://github.com/docker-hy/ml-kurkkumopo-backend\" target=\"_blank\" rel=\"noopener noreferrer\">backend</a> and\n<a href=\"https://github.com/docker-hy/ml-kurkkumopo-training\" target=\"_blank\" rel=\"noopener noreferrer\">training</a></p><p>Note that the training requires 2 volumes and backend should share volume <code class=\"language-text\">/src/model</code> with training.</p><p>The frontend will display on <a href=\"http://localhost:3000\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost:3000</a> and the application will tell if the subject of an image looks more\nlike a cucumber or a moped.</p><p>Submit the docker-compose.yml</p><ul>\n<li>\n<p>This exercise is known to have broken for some attendees based on CPU. The error looks something like \"Illegal instruction (core dumped)\". Try downgrading / upgrading the tensorflow found in requirements.txt or join the Discord channel and message with Jakousa#1337.</p>\n</li>\n<li>\n<p>Note that the generated model is a toy and will not produce good results.</p>\n</li>\n<li>\n<p>It will take SEVERAL minutes to build the docker images, download training pictures and train the classifying model.</p>\n</li>\n</ul><p>This exercise was created by <a href=\"https://github.com/sasumaki\" target=\"_blank\" rel=\"noopener noreferrer\">Sasu Mkinen</a></p></exercise><exercise name=\"Exercise 2.8\"><p>Add <a href=\"https://hub.docker.com/_/nginx\" target=\"_blank\" rel=\"noopener noreferrer\">nginx</a> to example frontend + backend.</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 646px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/d9c4468d5acf0246dbba4e71c2ee46ef/27524/back-front-redis-database-and-nginx.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 51.30434782608696%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABJUlEQVQoz2WS547DQAiE/f5P6KLIP1zj3hNXom9P5NZ3SAjwLsMwa6eqKhnHUYh930uWZbdaz8mLopAoiiQIAvF9X8IwlKZpRO26LnFoOI5D1nWV8zxN8zAMMs+zASHu+27OyQEoy9KAt20rXdfJtm0GDHO4pAX2fr9NEwB/bVkW4wBopH+aJnm9Xj+ANl0FhLVeUIMlrOq6/kY8SRJ5PB6/gADZDFmXNQDmEmujG9oqcxxplCnfkevLUAGJgKFNnucmsg4RhqwH+PP5NLXdRw3oDRCjiamwQHxcpxNVLx0AAWpy/KahPRFAtKRBH4gVAbKNMwgokX8r6wMgOHqyLhqRx3EsaZqa38y+T60SOPY0+wIArAdDch7JdV3xPO+2kS0Xj/IBAEUIhg7Pvo8AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <picture>\n          <source srcset=\"/static/d9c4468d5acf0246dbba4e71c2ee46ef/a0b58/back-front-redis-database-and-nginx.webp 230w,\n/static/d9c4468d5acf0246dbba4e71c2ee46ef/bc10c/back-front-redis-database-and-nginx.webp 460w,\n/static/d9c4468d5acf0246dbba4e71c2ee46ef/8c2f2/back-front-redis-database-and-nginx.webp 646w\" sizes=\"(max-width: 646px) 100vw, 646px\" type=\"image/webp\">\n          <source srcset=\"/static/d9c4468d5acf0246dbba4e71c2ee46ef/81c8e/back-front-redis-database-and-nginx.png 230w,\n/static/d9c4468d5acf0246dbba4e71c2ee46ef/08a84/back-front-redis-database-and-nginx.png 460w,\n/static/d9c4468d5acf0246dbba4e71c2ee46ef/27524/back-front-redis-database-and-nginx.png 646w\" sizes=\"(max-width: 646px) 100vw, 646px\" type=\"image/png\">\n          <img class=\"gatsby-resp-image-image\" src=\"/static/d9c4468d5acf0246dbba4e71c2ee46ef/27524/back-front-redis-database-and-nginx.png\" alt=\"back front redis database and nginx\" title=\"back front redis database and nginx\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n        </picture>\n  </a>\n    </span><p>Accessing your service from arbitrary port is counter intuitive since browsers use 80 (http) and 443 (https) by\ndefault. And having the service refer to two origins in a case where there's only one backend isn't desirable either. We will skip the SSL setup for https/443.</p><p>Nginx will function as a <a href=\"https://en.wikipedia.org/wiki/Reverse_proxy\" target=\"_blank\" rel=\"noopener noreferrer\">reverse proxy</a> for us (see the image above).\nThe requests arriving at anything other than /api will be redirected to frontend container and /api will get\nredirected to backend container.</p><p>At the end you should see that the frontend is accessible simply by going to <a href=\"http://localhost\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost</a> and the button works.\nOther buttons may have stopped working, do not worry about them.</p><p>As we will not start configuring reverse proxies on this course you can have a simple config file:</p><p>The following file should be set to /etc/nginx/nginx.conf inside the nginx container. You can use a file volume where\nthe contents of the file are the following:</p><div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">events { worker_connections 1024; }\n\nhttp {\n  server {\n    listen 80;\n\n    location / {\n      proxy_pass _frontend-connection-url_;\n    }\n\n    location /api/ {\n      proxy_set_header Host $host;\n      proxy_pass _backend-connection-url_;\n    }\n  }\n}</code></pre></div><p>Nginx, backend and frontend should be connected in the same network. See the image above for how the services are connected.</p><p>Submit the docker-compose.yml</p><text-box name=\"Tips for making sure the backend connection works\" variant=\"hint\"><p>Try using your browser to access <a href=\"http://localhost/api/ping\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost/api/ping</a> and see if it answers pong</p><p>It might be nginx configuration problem: Add trailing <code class=\"language-text\">/</code> to the backend url in the nginx.conf.</p></text-box></exercise><exercise name=\"Exercise 2.9\"><p>Postgres image uses a volume by default. Manually define volumes for the database in convenient location such as in\n<code class=\"language-text\">./database</code> . Use the image documentations (postgres) to help you with the task. You may do the same for redis as\nwell.</p><p>After you have configured the volume:</p><ul>\n<li>Save a few messages through the frontend</li>\n<li>Run <code class=\"language-text\">docker-compose down</code></li>\n<li>Run <code class=\"language-text\">docker-compose up</code> and see that the messages are available after refreshing browser</li>\n<li>Run <code class=\"language-text\">docker-compose down</code> and delete the volume folder manually</li>\n<li>Run <code class=\"language-text\">docker-compose up</code> and the data should be gone</li>\n</ul><p>Maybe it would be simpler to back them up now that you know where they are.</p><blockquote>\n<p>TIP: To save you the trouble of testing all of those steps, just look into the folder before trying the steps. If\nit's empty after docker-compose up then something is wrong.</p>\n</blockquote><blockquote>\n<p>TIP: Since you may have broken the buttons in nginx exercise you should test with a version of docker-compose.yml that doesn't break the buttons</p>\n</blockquote><p>Submit the docker-compose.yml</p></exercise><exercise name=\"Exercise 2.10\"><p>Some buttons may have stopped working in the frontend + backend project. Make sure that every button for exercises\nworks.</p><p>This may need a peek into the browsers developer consoles again like back part 1. The buttons of nginx exercise and\nthe first button behave differently but you want them to match.</p><p>If you had to do any changes explain what you had to change.</p><p>Submit the docker-compose yml and both dockerfiles.</p></exercise></div>","frontmatter":{"path":"/part-2/3-volumes-in-action","title":"Volumes in action"},"fileAbsolutePath":"/home/runner/work/dockeruh/dockeruh/data/part-2/section-3.md"},"allPages":{"edges":[{"node":{"id":"78fbcd97-1206-5e2c-aa7a-2355c7d3d2d4","frontmatter":{"path":"/faq","title":"Frequently asked questions"}}},{"node":{"id":"8ce67b08-bc98-57f2-97c3-34c31cef920c","frontmatter":{"path":"/frontmatter-guide","title":"Frontmatter-guide"}}},{"node":{"id":"9586f0d5-0847-5609-8ce9-783dec1c6474","frontmatter":{"path":"/getting-started","title":"Getting started"}}},{"node":{"id":"586d3cc5-6375-5cc3-a380-fa7c92c444f6","frontmatter":{"path":"/","title":"About this course"}}},{"node":{"id":"570cbdcb-35dd-597d-9296-1db787f1a2ba","frontmatter":{"path":"/links","title":"Links"}}},{"node":{"id":"6482c1de-336e-5ca0-921c-2f872710464e","frontmatter":{"path":"/part-1","title":"Part 1"}}},{"node":{"id":"fb43a603-5b9d-5661-b6b9-54da7d539cda","frontmatter":{"path":"/part-1/1-getting-started","title":"Definitions and basic concepts"}}},{"node":{"id":"931e4820-9cf8-57ce-841f-8928fba4448e","frontmatter":{"path":"/part-1/2-running-and-stopping","title":"Running and stopping containers"}}},{"node":{"id":"a5745d79-06c3-53ab-b41e-c258cbaaa39e","frontmatter":{"path":"/part-1/3-in-depth-dive-to-images","title":"In-depth dive to images"}}},{"node":{"id":"6777342e-aa39-5b24-b2a4-b3b257720a3e","frontmatter":{"path":"/part-1/4-defining-start-conditions","title":"Defining start conditions for the container"}}},{"node":{"id":"838a3df5-a468-5c55-804e-320698936a5b","frontmatter":{"path":"/part-1/5-volumes-and-ports","title":"Interacting with the container via volumes and ports"}}},{"node":{"id":"f9b46527-28d1-55c3-b6a3-9cf078f68442","frontmatter":{"path":"/part-1/6-docker-hub","title":"Utilizing tools from the Registry"}}},{"node":{"id":"03d57907-e399-59e1-b31f-2f5c4cae8364","frontmatter":{"path":"/part-1/7-summary","title":"Summary"}}},{"node":{"id":"abbbb192-1233-556c-be2b-99ddd8018805","frontmatter":{"path":"/part-2","title":"Part 2"}}},{"node":{"id":"cdd6ac14-8e15-5a14-96fc-0db85aaa96e1","frontmatter":{"path":"/part-2/1-migrating-to-docker-compose","title":"Migrating to docker compose"}}},{"node":{"id":"5e98e3a7-4c6d-5e74-b362-9214ca8667c6","frontmatter":{"path":"/part-2/2-docker-networking","title":"Docker networking"}}},{"node":{"id":"b76d6612-47f0-51df-8502-9c8cafd28daa","frontmatter":{"path":"/part-2/3-volumes-in-action","title":"Volumes in action"}}},{"node":{"id":"488142c8-3933-505b-9676-b0616b850285","frontmatter":{"path":"/part-2/4-containers-in-development","title":"Containers in development"}}},{"node":{"id":"6d4f48ee-6029-5e85-860c-bcc63886ef6e","frontmatter":{"path":"/part-2/5-summary","title":"Summary"}}},{"node":{"id":"917133c7-7a4a-5fd3-8d8e-32c8c87ace46","frontmatter":{"path":"/part-3","title":"Part 3"}}},{"node":{"id":"bdcd9fef-a7d9-5fa9-9e83-690be6709487","frontmatter":{"path":"/part-3/1-deeper-understainding-of-containers","title":"Deeper understanding of containers"}}},{"node":{"id":"3269eaff-51d8-510c-bb92-49a46373f01c","frontmatter":{"path":"/part-3/2-deployment-pipelines","title":"Deployment pipelines"}}},{"node":{"id":"e38e2740-2353-5423-8f22-0381c1d6a859","frontmatter":{"path":"/part-3/3-using-non-root-user","title":"Using a non-root user"}}},{"node":{"id":"b809a602-38d5-55b0-91a1-469bc8d243b8","frontmatter":{"path":"/part-3/4-optimizing-the-image-size","title":"Optimizing the image size"}}},{"node":{"id":"3c8a8394-d799-5af0-9f92-fc70f5dd3625","frontmatter":{"path":"/part-3/5-multi-host-environments","title":"Multi-host environments"}}},{"node":{"id":"ab1ed629-bddc-5dbc-9f88-a3559da3b882","frontmatter":{"path":"/part-3/6-end","title":"End"}}}]}},"pageContext":{}},"staticQueryHashes":["3294351120","994120085"]}